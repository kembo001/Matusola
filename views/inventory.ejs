<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Character encoding and viewport -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Primary SEO meta tags -->
    <title>Vehicle Inventory | Wholesale Cars MN</title>
    <meta name="description" content="Browse our inventory of quality pre-owned vehicles at Wholesale Cars MN. Find your next car, truck, or SUV in Ramsey, MN." />    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Vehicle Inventory - Wholesale Cars MN" />
    <meta property="og:description" content="Browse our selection of quality pre-owned vehicles at Wholesale Cars MN. Updated daily with new arrivals. Find your next car in Ramsey, MN." />
    <meta property="og:image" content="https://www.wholesalecarsmn.com/images/our-inventory.jpg" />
    <meta property="og:url" content="https://www.wholesalecarsmn.com/inventory" />
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.wholesalecarsmn.com/inventory" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/styles.css" />
</head>
  <body>
    <div class="banner">
      <a href="/" class="banner__title">Wholesale Cars</a>
      <a href="https://maps.app.goo.gl/oiKn7Hk6RhoiGgvX9" target="_blank" class="banner__address">üìç 7820 Riverdale drive NW, Ramsey, MN 55303 </a>
      <div class="banner__phones">
        <a href="tel:763-242-6155" class="banner__phone">üìû (763) 242-6155 </a>
        <a href="tel:612-459-9927" class="banner__phone">- (612) 459-9927 </a>
      </div>
    </div>

    <div class="filters">
      <div class="filters__group">
        <select class="filters__select" name="status" onchange="updateFilters(this)">
          <option value="available" <%= currentStatus === 'available' ? 'selected' : '' %>>Available Vehicles</option>
          <option value="sold" <%= currentStatus === 'sold' ? 'selected' : '' %>>Sold Vehicles</option>
          <option value="all" <%= currentStatus === 'all' ? 'selected' : '' %>>All Vehicles</option>
        </select>
      </div>

      <div class="filters__group">
        <select class="filters__select" name="sort" onchange="updateFilters(this)">
          <option value="newest" <%= currentSort === 'newest' ? 'selected' : '' %>>Newest First</option>
          <option value="price-high" <%= currentSort === 'price-high' ? 'selected' : '' %>>Price: High to Low</option>
          <option value="price-low" <%= currentSort === 'price-low' ? 'selected' : '' %>>Price: Low to High</option>
          <option value="mileage-low" <%= currentSort === 'mileage-low' ? 'selected' : '' %>>Mileage: Low to High</option>
          <option value="mileage-high" <%= currentSort === 'mileage-high' ? 'selected' : '' %>>Mileage: High to Low</option>
        </select>
      </div>
    </div>

    <div class="inventory">
      <% vehicles.forEach(vehicle => { %>
      <div class="inventory__card">
        <div class="inventory__image">
          <div class="inventory__gallery-container">
            <img src="<%= vehicle.image_url %>" alt="<%= vehicle.title %>" loading="lazy" />
            <% if (vehicle.status === 'sold') { %>
              <div class="inventory__sold-overlay">SOLD</div>
            <% } %>
          </div>
          <button class="inventory__gallery-prev" style="display: none;">‚Üê</button>
          <button class="inventory__gallery-next" style="display: none;">‚Üí</button>
          <div class="inventory__gallery-loading" style="display: none;">
            <div class="inventory__loading-spinner"></div>
            <div>Loading images...</div>
          </div>
          <div class="inventory__counter" style="display: none;">
            <span id="currentImage">1</span>/<span id="totalImages">1</span>
          </div>
        </div>

        <div class="inventory__content">
          <div class="inventory__info">
            <h2 class="inventory__title"><%= vehicle.title %></h2>
            <p class="inventory__mileage"><%= vehicle.mileage.toLocaleString() %> miles</p>
            <p class="inventory__vin">VIN: <%= vehicle.vin %></p>
          </div>

          <div class="inventory__actions">
            <p class="inventory__price">$<%= vehicle.price.toLocaleString() %></p>
            <button 
              class="inventory__button" 
              onclick="toggleDetails(this)" 
              data-vehicle-id="<%= vehicle.id %>"
              data-images-folder="<%= vehicle.images_folder %>">
              See More
            </button>
          </div>
        </div>

        <div class="inventory__expand">
          <div class="inventory__details">
            <div class="inventory__specs">
              <p class="inventory__spec"><strong>Year:</strong> <%= vehicle.year %></p>
              <p class="inventory__spec"><strong>Make:</strong> <%= vehicle.make %></p>
              <p class="inventory__spec"><strong>Model:</strong> <%= vehicle.model %></p>
              <p class="inventory__spec"><strong>Trim:</strong> <%= vehicle.trim %></p>
              <p class="inventory__spec"><strong>Engine:</strong> <%= vehicle.engine %></p>
              <p class="inventory__spec"><strong>Transmission:</strong> <%= vehicle.transmission %></p>
              <p class="inventory__spec"><strong>Drivetrain:</strong> <%= vehicle.drivetrain %></p>
              <p class="inventory__spec"><strong>Title Status:</strong> 
                <span class="inventory__title-status inventory__title-status--<%= vehicle.title_status.toLowerCase().replace(' ', '-') %>">
                  <%= vehicle.title_status %>
                </span>
              </p>
            </div>
          </div>
        </div>
      </div>
      <% }); %>
    </div>

    <div class="pagination">
      <% if (hasPrevPage) { %>
      <a href="/inventory?page=<%= currentPage - 1 %>&status=<%= currentStatus %>&sort=<%= currentSort %>" class="pagination__button">Previous</a>
      <% } %>

      <span class="pagination__info">Page <%= currentPage %> of <%= totalPages %></span>

      <% if (hasNextPage) { %>
      <a href="/inventory?page=<%= currentPage + 1 %>&status=<%= currentStatus %>&sort=<%= currentSort %>" class="pagination__button">Next</a>
      <% } %>
    </div>
    
    <script>
    function updateFilters(select) {
      const status = document.querySelector('select[name="status"]').value;
      const sort = document.querySelector('select[name="sort"]').value;
      window.location.href = `/inventory?status=${status}&sort=${sort}`;
    }

    function toggleDetails(button) {
      const card = button.closest('.inventory__card');
      const expandSection = card.querySelector('.inventory__expand');
      const isExpanding = !expandSection.classList.contains('active');
      
      expandSection.classList.toggle('active');
      button.textContent = isExpanding ? 'See Less' : 'See More';
      
      if (isExpanding && !button.dataset.imagesLoaded) {
        const imagesFolder = button.dataset.imagesFolder;
        loadVehicleImages(card, imagesFolder);
        button.dataset.imagesLoaded = 'true';
      }
    }

    function loadVehicleImages(card, imagesFolder) {
      const galleryContainer = card.querySelector('.inventory__gallery-container');
      const loadingEl = card.querySelector('.inventory__gallery-loading');
      const prevBtn = card.querySelector('.inventory__gallery-prev');
      const nextBtn = card.querySelector('.inventory__gallery-next');
      const counter = card.querySelector('.inventory__counter');
      const currentImageEl = counter.querySelector('#currentImage');
      const totalImagesEl = counter.querySelector('#totalImages');
      
      loadingEl.style.display = 'block';
      prevBtn.style.display = 'none';
      nextBtn.style.display = 'none';
      counter.style.display = 'none';
      
      // Create array to store all images
      const images = [];
      let loadedCount = 0;
      
      // Add the first image that's already loaded
      const firstImage = galleryContainer.querySelector('img');
      images.push(firstImage);
      
      // Function to load additional images
      const loadImage = (index) => {
        const img = new Image();
        img.src = `https://wholesalecars.sfo3.cdn.digitaloceanspaces.com/${imagesFolder}/${index}.jpg`;
        
        img.onload = () => {
          loadedCount++;
          images.push(img);
          img.style.display = 'none';
          galleryContainer.appendChild(img);
          
          // Try loading next image
          loadImage(index + 1);
          
          // If we have at least 2 images, show navigation and counter
          if (images.length >= 2) {
            loadingEl.style.display = 'none';
            prevBtn.style.display = 'block';
            nextBtn.style.display = 'block';
            counter.style.display = 'block';
            totalImagesEl.textContent = images.length;
            setupNavigation(card, images);
          }
        };
        
        img.onerror = () => {
          if (images.length > 0) {
            loadingEl.style.display = 'none';
            if (images.length > 1) {
              prevBtn.style.display = 'block';
              nextBtn.style.display = 'block';
              counter.style.display = 'block';
              totalImagesEl.textContent = images.length;
            }
            setupNavigation(card, images);
          }
        };
      };
      
      // Start loading from image 2 (since 1 is already loaded)
      loadImage(2);
    }

    function setupNavigation(card, images) {
      let currentIndex = 0;
      const prevBtn = card.querySelector('.inventory__gallery-prev');
      const nextBtn = card.querySelector('.inventory__gallery-next');
      const currentImageEl = card.querySelector('#currentImage');
      
      // Make sure first image is visible and counter is set
      images[0].style.display = 'block';
      currentImageEl.textContent = '1';
      
      prevBtn.onclick = () => {
        images[currentIndex].style.display = 'none';
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        images[currentIndex].style.display = 'block';
        currentImageEl.textContent = currentIndex + 1;
      };
      
      nextBtn.onclick = () => {
        images[currentIndex].style.display = 'none';
        currentIndex = (currentIndex + 1) % images.length;
        images[currentIndex].style.display = 'block';
        currentImageEl.textContent = currentIndex + 1;
      };
    }
    </script>

  </body>
</html>